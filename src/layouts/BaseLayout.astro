---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image = "/assets/share-img.png" } = Astro.props;
---

<!doctype html>
<html lang="en">
  <head>
    <BaseHead title={title} description={description} image={image} />
  </head>
  <body>
    <div class="page-wrapper">
      <img
        id="decor-artwork"
        src="/assets/backgrounds/art-home%20light%20max.svg"
        alt=""
        aria-hidden="true"
        role="presentation"
        class="decor-topright"
        loading="lazy"
      />
      <div class="page-padding">
        <Header />
        <main id="main">
          <slot />
        </main>
      </div>
      <Footer />
      <img
        id="decor-footer"
        src="/assets/footers/footer%20art%20large-med%20light.svg"
        alt=""
        aria-hidden="true"
        role="presentation"
        class="decor-footer"
        loading="lazy"
      />
    </div>

    <!-- replace page content with mobile menu, vice versa -->
    <script is:inline type="text/javascript">
      function menuToggle() {
        var closeIcon = document.getElementById("close-icon");
        var hamburgerIcon = document.getElementById("hamburger-icon");
        var menu = document.getElementById("mobile-nav");
        const body = document.body;
        const main = document.getElementById("main");
        const footer = document.getElementById("footer");

        if (menu.style.display === "block") {
          // Close the menu, show the hamburger icon
          menu.style.display = "none";
          body.classList.remove("no-scroll"); // Enable scrolling
          closeIcon.style.display = "none";
          hamburgerIcon.style.display = "block";
        } else {
          // Open the menu, show the close icon
          menu.style.display = "block";
          body.classList.add("no-scroll"); //disable scrolling
          closeIcon.style.display = "block";
          hamburgerIcon.style.display = "none";
        }
      }
    </script>
    <!-- if mobile menu is open and resize to desktop, kill menu and restore page contents -->
    <script is:inline type="text/javascript">
      function handleResize() {
        const width = window.innerWidth; // Get the current viewport width
        const mobileWidthThreshold = 768; // Set the threshold width
        var menu = document.getElementById("mobile-nav");

        if (width > mobileWidthThreshold && menu.style.display === "block") {
          menuToggle();
        }
      }
      // Add the resize event listener to the window
      window.addEventListener("resize", handleResize);
    </script>
    <script>
      const themeToggleButton = document.getElementById("theme-toggle");
      /** @type {HTMLImageElement | null} */
      const decorImg = document.getElementById("decor-artwork");
      /** @type {HTMLImageElement | null} */
      const footerImg = document.getElementById("decor-footer");
      let currentTheme = localStorage.getItem("theme");

      function getArtworkBaseName() {
        if (typeof window === "undefined") return null;
        const path = window.location.pathname || "/";
        if (path === "/" || path === "" || path === "/index") return "art-home";
        if (path.startsWith("/archive")) return "art-archive";
        if (path === "/tags" || path.startsWith("/tags/"))
          return "art-collection";
        if (path === "/posts" || path.startsWith("/posts/"))
          return "art-general";
        if (path === "/about" || path.startsWith("/about/"))
          return "art-static";
        return null; // no artwork for other pages
      }

      function updateDecorArtwork() {
        if (!(decorImg instanceof HTMLImageElement)) return;
        const artBase = getArtworkBaseName();
        if (!artBase) {
          decorImg.style.display = "none";
          decorImg.style.width = "";
          return;
        }

        const vw = window.innerWidth || document.documentElement.clientWidth;
        let sizeSuffix = "max";
        // For archive and about pages, use the 820-580 variant when viewport is <= 820px
        if (artBase === "art-archive" || artBase === "art-static") {
          if (vw <= 820) {
            sizeSuffix = "820-580";
          } else {
            sizeSuffix = "max";
          }
        }
        // For collection, general, and home pages, use '820' when viewport is between 580 and 820, '580' when <580
        else if (
          artBase === "art-collection" ||
          artBase === "art-general" ||
          artBase === "art-home"
        ) {
          if (vw <= 820 && vw >= 580) {
            sizeSuffix = "820";
          } else if (vw < 580) {
            sizeSuffix = "580";
          } else {
            sizeSuffix = "max";
          }
        }

        const variant = document.body.classList.contains("dark-theme")
          ? "dark"
          : "light";

        // ensure the image is shown (override small-screen CSS when needed)
        decorImg.style.display = "block";
        // Adjust width based on artwork type:
        // - art-home: keep the default wide treatment (60vw from CSS)
        // - art-general & art-archive: smoothly scale from ~60vw on small screens to ~20vw on large screens
        // - art-static: smoothly scale from ~90vw on small screens to ~20vw on large screens
        // - art-collection: smoothly scale from ~110vw on small screens to ~60vw on large screens
        // - others: fall back to CSS default (60vw)
        if (
          artBase === "art-general" ||
          artBase === "art-static" ||
          artBase === "art-archive" ||
          artBase === "art-collection"
        ) {
          const viewportWidthPx = vw;
          const smallBreakpoint = 480; // px
          const largeBreakpoint = 820; // px
          const minVw = artBase === "art-collection" ? 40 : 20; // target on large screens
          const maxVw =
            artBase === "art-static"
              ? 90
              : artBase === "art-archive"
                ? 80
                : artBase === "art-collection"
                  ? 110
                  : 60; // target on small screens

          const clampedWidth = Math.max(
            smallBreakpoint,
            Math.min(largeBreakpoint, viewportWidthPx)
          );
          const t =
            (clampedWidth - smallBreakpoint) /
            (largeBreakpoint - smallBreakpoint); // 0 → 1
          const widthVw = maxVw - t * (maxVw - minVw); // 60 → 20

          decorImg.style.width = `${widthVw}vw`;
        } else {
          decorImg.style.width = "60vw";
        }
        decorImg.src = `/assets/backgrounds/${artBase}%20${variant}%20${sizeSuffix}.svg`;
      }

      function updateFooterArtwork() {
        if (!(footerImg instanceof HTMLImageElement)) return;
        const vw = window.innerWidth || document.documentElement.clientWidth;
        const sizeSuffix = vw <= 580 ? "small" : "large-med";
        const variant = document.body.classList.contains("dark-theme")
          ? "dark"
          : "light";
        footerImg.style.display = "block";
        footerImg.src = `/assets/footers/footer%20art%20${sizeSuffix}%20${variant}.svg`;
      }

      // initial theme detection
      if (currentTheme === "dark") {
        document.body.classList.add("dark-theme");
      } else if (currentTheme === "light") {
        document.body.classList.remove("dark-theme");
      } else if (
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches
      ) {
        document.body.classList.add("dark-theme");
      }

      // set artwork initially (path + theme)
      updateDecorArtwork();
      updateFooterArtwork?.();

      // update artwork when theme toggles
      themeToggleButton?.addEventListener("click", () => {
        if (document.body.classList.contains("dark-theme")) {
          document.body.classList.remove("dark-theme");
          localStorage.setItem("theme", "light");
        } else {
          document.body.classList.add("dark-theme");
          localStorage.setItem("theme", "dark");
        }
        updateDecorArtwork();
        updateFooterArtwork();
      });

      // handle back/forward navigation updates
      window.addEventListener("popstate", updateDecorArtwork);
      window.addEventListener("popstate", updateFooterArtwork);
      // update artwork when viewport size changes
      window.addEventListener("resize", updateDecorArtwork);
      window.addEventListener("resize", updateFooterArtwork);
    </script>
  </body><!-- if mobile menu is open and resize to desktop, kill menu and restore page contents -->
</html>
